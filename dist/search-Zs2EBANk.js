import{d as e,j as s}from"./admin-B662x858.js";import{p as a,q as t,w as l,n as r,M as c,N as i,s as n,r as o}from"./vendor-C5LqAqW7.js";const d={async searchArticles(s,o={},d=10,u=null){const h=a(e,"articles");let g=t(h,l("published","==",!0));s&&(g=t(g,l("searchTokens","array-contains",s.toLowerCase()))),o.category&&(g=t(g,l("category","==",o.category))),o.tags&&o.tags.length>0&&(g=t(g,l("tags","array-contains-any",o.tags))),o.author&&(g=t(g,l("author","==",o.author))),g=t(g,r("date","desc")),g=t(g,c(d+1)),u&&(g=t(g,i(u)));const m=(await n(g)).docs,x=m.length>d,p=x?m[m.length-2]:null;return{articles:m.slice(0,d).map((e=>({id:e.id,...e.data()}))),hasMore:x,lastDoc:p}},async getSuggestions(s,i=5){const o=a(e,"articles"),d=t(o,l("published","==",!0),l("searchTokens","array-contains",s.toLowerCase()),r("title"),c(i));return(await n(d)).docs.map((e=>e.data().title))},highlightSearchTerms(e,s){if(!e||!s)return e;const a=new RegExp(`(${s})`,"gi");return e.replace(a,"<mark>$1</mark>")}},u=()=>{var e;const[a,t]=o.useState(""),[l,r]=o.useState(null),[c,i]=o.useState({category:"",tags:[],author:"",status:"published"}),[n,u]=o.useState(!1),[h,g]=o.useState([]);o.useEffect((()=>{const e=setTimeout((async()=>{if(a.length>=2){const e=await d.getSuggestions(a);g(e)}else g([])}),300);return()=>clearTimeout(e)}),[a]);return s.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[s.jsx("div",{className:"mb-6",children:s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",value:a,onChange:e=>t(e.target.value),placeholder:"Rechercher...",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),h.length>0&&s.jsx("div",{className:"absolute z-10 w-full bg-white mt-1 rounded-lg shadow-lg",children:h.map(((e,a)=>s.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",onClick:()=>{t(e),g([])},children:e},a)))})]})}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Filtres"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Catégorie"}),s.jsxs("select",{value:c.category,onChange:e=>i((s=>({...s,category:e.target.value}))),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"",children:"Toutes les catégories"}),s.jsx("option",{value:"tech",children:"Technologie"}),s.jsx("option",{value:"business",children:"Business"}),s.jsx("option",{value:"marketing",children:"Marketing"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Auteur"}),s.jsx("input",{type:"text",value:c.author||"",onChange:e=>i((s=>({...s,author:e.target.value}))),placeholder:"Nom de l'auteur",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tags"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:null==(e=c.tags)?void 0:e.map((e=>s.jsxs("span",{className:"bg-blue-100 text-blue-800 text-sm px-2 py-1 rounded flex items-center gap-1",children:[e,s.jsx("button",{onClick:()=>i((s=>{var a;return{...s,tags:(null==(a=s.tags)?void 0:a.filter((s=>s!==e)))||[]}})),className:"text-blue-800 hover:text-blue-900",children:"×"})]},e)))})]})]}),s.jsx("div",{className:"flex justify-center mb-6",children:s.jsx("button",{onClick:async()=>{u(!0);try{const e=await d.searchArticles(a,c);r(e)}catch(e){}u(!1)},disabled:n,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium disabled:opacity-50",children:n?"Recherche en cours...":"Rechercher"})}),l&&s.jsxs("div",{children:[s.jsx("div",{className:"mb-4",children:s.jsxs("h2",{className:"text-lg font-semibold",children:[l.articles.length," résultat(s) trouvé(s)"]})}),s.jsx("div",{className:"space-y-4",children:l.articles.map((e=>{const t=d.highlightSearchTerms(e.title,a),l=e.description?d.highlightSearchTerms(e.description,a):"";return s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 mb-4",children:[s.jsx("h3",{className:"text-xl font-semibold mb-2",dangerouslySetInnerHTML:{__html:t}}),e.description&&s.jsx("p",{className:"text-gray-600 mb-2",dangerouslySetInnerHTML:{__html:l}}),s.jsx("div",{className:"flex flex-wrap gap-2",children:e.tags.map((e=>s.jsx("span",{className:"bg-blue-100 text-blue-800 text-sm px-2 py-1 rounded",children:e},e)))})]},e.id)}))}),l.hasMore&&s.jsx("div",{className:"mt-6 flex justify-center",children:s.jsx("button",{onClick:async()=>{if(null==l?void 0:l.lastDoc)try{const e=await d.searchArticles(a,c,10,l.lastDoc);r({articles:[...(null==l?void 0:l.articles)||[],...(null==e?void 0:e.articles)||[]],hasMore:e.hasMore,lastDoc:e.lastDoc})}catch(e){}},className:"bg-gray-100 hover:bg-gray-200 text-gray-800 px-6 py-2 rounded-lg font-medium",children:"Charger plus"})})]})]})};export{u as A};
//# sourceMappingURL=search-Zs2EBANk.js.map
