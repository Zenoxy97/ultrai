{"version":3,"file":"search-Zs2EBANk.js","sources":["../src/services/searchService.ts","../src/components/search/AdvancedSearch.tsx"],"sourcesContent":["import { \n  collection,\n  query as firestoreQuery,\n  limit as firestoreLimit,\n  startAfter,\n  getDocs,\n  DocumentData,\n  QueryDocumentSnapshot,\n  where,\n  orderBy\n} from 'firebase/firestore';\nimport { db } from '../config/firebase';\nimport { Article } from '../types/Article';\n\nexport interface SearchFilters {\n  category?: string;\n  tags?: string[];\n  author?: string;\n  startDate?: Date;\n  endDate?: Date;\n  status?: 'draft' | 'published';\n}\n\nexport interface SearchResults {\n  articles: Article[];\n  hasMore: boolean;\n  lastDoc: QueryDocumentSnapshot<DocumentData> | null;\n}\n\nexport interface SearchStats {\n  totalResults: number;\n  searchTime: number;\n  categories: { [key: string]: number };\n  tags: { [key: string]: number };\n}\n\nexport const searchService = {\n  async searchArticles(searchQuery: string, filters: SearchFilters = {}, pageSize: number = 10, lastDoc: QueryDocumentSnapshot<DocumentData> | null = null): Promise<SearchResults> {\n    const articlesRef = collection(db, 'articles');\n    let q = firestoreQuery(articlesRef, where('published', '==', true));\n\n    if (searchQuery) {\n      q = firestoreQuery(q, where('searchTokens', 'array-contains', searchQuery.toLowerCase()));\n    }\n\n    if (filters.category) {\n      q = firestoreQuery(q, where('category', '==', filters.category));\n    }\n\n    if (filters.tags && filters.tags.length > 0) {\n      q = firestoreQuery(q, where('tags', 'array-contains-any', filters.tags));\n    }\n\n    if (filters.author) {\n      q = firestoreQuery(q, where('author', '==', filters.author));\n    }\n\n    q = firestoreQuery(q, orderBy('date', 'desc'));\n    q = firestoreQuery(q, firestoreLimit(pageSize + 1));\n\n    if (lastDoc) {\n      q = firestoreQuery(q, startAfter(lastDoc));\n    }\n\n    const snapshot = await getDocs(q);\n    const docs = snapshot.docs;\n    const hasMore = docs.length > pageSize;\n    const lastVisible = hasMore ? docs[docs.length - 2] : null;\n    \n    const articles = docs.slice(0, pageSize).map(doc => ({\n      id: doc.id,\n      ...doc.data()\n    } as Article));\n\n    return {\n      articles,\n      hasMore,\n      lastDoc: lastVisible\n    };\n  },\n\n  async getSuggestions(searchQuery: string, limit: number = 5): Promise<string[]> {\n    const articlesRef = collection(db, 'articles');\n    const q = firestoreQuery(\n      articlesRef,\n      where('published', '==', true),\n      where('searchTokens', 'array-contains', searchQuery.toLowerCase()),\n      orderBy('title'),\n      firestoreLimit(limit)\n    );\n\n    const snapshot = await getDocs(q);\n    return snapshot.docs.map(doc => doc.data().title);\n  },\n\n  highlightSearchTerms(text: string, query: string): string {\n    if (!text || !query) return text;\n    const regex = new RegExp(`(${query})`, 'gi');\n    return text.replace(regex, '<mark>$1</mark>');\n  }\n};\n","import React, { useState, useEffect } from 'react';\nimport { SearchFilters, SearchResults, searchService } from '../../services/searchService';\nimport { Article } from '../../types/Article';\n\nexport const AdvancedSearch: React.FC = () => {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [results, setResults] = useState<SearchResults | null>(null);\n  const [filters, setFilters] = useState<SearchFilters>({\n    category: '',\n    tags: [],\n    author: '',\n    status: 'published'\n  });\n  const [loading, setLoading] = useState(false);\n  const [suggestions, setSuggestions] = useState<string[]>([]);\n\n  useEffect(() => {\n    const fetchSuggestions = async () => {\n      if (searchQuery.length >= 2) {\n        const results = await searchService.getSuggestions(searchQuery);\n        setSuggestions(results);\n      } else {\n        setSuggestions([]);\n      }\n    };\n\n    const timeoutId = setTimeout(fetchSuggestions, 300);\n    return () => clearTimeout(timeoutId);\n  }, [searchQuery]);\n\n  const handleSearch = async () => {\n    setLoading(true);\n    try {\n      const searchResults = await searchService.searchArticles(searchQuery, filters);\n      setResults(searchResults);\n    } catch (error) {\n      console.error('Erreur lors de la recherche:', error);\n    }\n    setLoading(false);\n  };\n\n  const handleLoadMore = async () => {\n    if (!results?.lastDoc) return;\n\n    try {\n      const nextResults = await searchService.searchArticles(searchQuery, filters, 10, results.lastDoc);\n      setResults({\n        articles: [...(results?.articles || []), ...(nextResults?.articles || [])],\n        hasMore: nextResults.hasMore,\n        lastDoc: nextResults.lastDoc\n      });\n    } catch (error) {\n      console.error('Erreur lors du chargement de plus de résultats:', error);\n    }\n  };\n\n  const renderArticleCard = (article: Article) => {\n    const highlightedTitle = searchService.highlightSearchTerms(article.title, searchQuery);\n    const highlightedDescription = article.description\n      ? searchService.highlightSearchTerms(article.description, searchQuery)\n      : '';\n\n    return (\n      <div key={article.id} className=\"bg-white rounded-lg shadow-md p-4 mb-4\">\n        <h3 className=\"text-xl font-semibold mb-2\" dangerouslySetInnerHTML={{ __html: highlightedTitle }} />\n        {article.description && (\n          <p className=\"text-gray-600 mb-2\" dangerouslySetInnerHTML={{ __html: highlightedDescription }} />\n        )}\n        <div className=\"flex flex-wrap gap-2\">\n          {article.tags.map(tag => (\n            <span\n              key={tag}\n              className=\"bg-blue-100 text-blue-800 text-sm px-2 py-1 rounded\"\n            >\n              {tag}\n            </span>\n          ))}\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-4\">\n      <div className=\"mb-6\">\n        <div className=\"relative\">\n          <input\n            type=\"text\"\n            value={searchQuery}\n            onChange={e => setSearchQuery(e.target.value)}\n            placeholder=\"Rechercher...\"\n            className=\"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          />\n          {suggestions.length > 0 && (\n            <div className=\"absolute z-10 w-full bg-white mt-1 rounded-lg shadow-lg\">\n              {suggestions.map((suggestion, index) => (\n                <div\n                  key={index}\n                  className=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\"\n                  onClick={() => {\n                    setSearchQuery(suggestion);\n                    setSuggestions([]);\n                  }}\n                >\n                  {suggestion}\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"mb-6\">\n        <h2 className=\"text-lg font-semibold mb-4\">Filtres</h2>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Catégorie\n            </label>\n            <select\n              value={filters.category}\n              onChange={e => setFilters(prev => ({ ...prev, category: e.target.value }))}\n              className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            >\n              <option value=\"\">Toutes les catégories</option>\n              <option value=\"tech\">Technologie</option>\n              <option value=\"business\">Business</option>\n              <option value=\"marketing\">Marketing</option>\n            </select>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Auteur\n            </label>\n            <input\n              type=\"text\"\n              value={filters.author || ''}\n              onChange={e => setFilters(prev => ({ ...prev, author: e.target.value }))}\n              placeholder=\"Nom de l'auteur\"\n              className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-4\">\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n            Tags\n          </label>\n          <div className=\"flex flex-wrap gap-2\">\n            {filters.tags?.map(tag => (\n              <span\n                key={tag}\n                className=\"bg-blue-100 text-blue-800 text-sm px-2 py-1 rounded flex items-center gap-1\"\n              >\n                {tag}\n                <button\n                  onClick={() => setFilters(prev => ({\n                    ...prev,\n                    tags: prev.tags?.filter(t => t !== tag) || []\n                  }))}\n                  className=\"text-blue-800 hover:text-blue-900\"\n                >\n                  ×\n                </button>\n              </span>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex justify-center mb-6\">\n        <button\n          onClick={handleSearch}\n          disabled={loading}\n          className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium disabled:opacity-50\"\n        >\n          {loading ? 'Recherche en cours...' : 'Rechercher'}\n        </button>\n      </div>\n\n      {results && (\n        <div>\n          <div className=\"mb-4\">\n            <h2 className=\"text-lg font-semibold\">\n              {results.articles.length} résultat(s) trouvé(s)\n            </h2>\n          </div>\n\n          <div className=\"space-y-4\">\n            {results.articles.map(renderArticleCard)}\n          </div>\n\n          {results.hasMore && (\n            <div className=\"mt-6 flex justify-center\">\n              <button\n                onClick={handleLoadMore}\n                className=\"bg-gray-100 hover:bg-gray-200 text-gray-800 px-6 py-2 rounded-lg font-medium\"\n              >\n                Charger plus\n              </button>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n"],"names":["searchService","searchArticles","searchQuery","filters","pageSize","lastDoc","articlesRef","collection","db","q","firestoreQuery","where","toLowerCase","category","tags","length","author","orderBy","firestoreLimit","startAfter","docs","getDocs","hasMore","lastVisible","articles","slice","map","doc","id","data","getSuggestions","limit","title","highlightSearchTerms","text","query","regex","RegExp","replace","AdvancedSearch","setSearchQuery","useState","results","setResults","setFilters","status","loading","setLoading","suggestions","setSuggestions","useEffect","timeoutId","setTimeout","async","clearTimeout","jsxs","className","children","jsx","jsxRuntimeExports","type","value","onChange","e","target","placeholder","suggestion","index","onClick","prev","_a","tag","filter","t","searchResults","error","disabled","article","highlightedTitle","highlightedDescription","description","dangerouslySetInnerHTML","__html","nextResults"],"mappings":"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"}